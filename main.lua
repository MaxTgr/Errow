local sheetFile = require( "sheet" )----Loading physics and setting the gravity to 0local physics = require( "physics" )physics.start()physics.setGravity( 0, 0 )----hiding the notification bardisplay.setStatusBar(display.HiddenStatusBar)----Groupslocal backGroup = display.newGroup()local itemGroup = display.newGroup()local playerGroup = display.newGroup()local uiGroup = display.newGroup() ----getting the center of the screenlocal centerX = display.contentCenterXlocal centerY = display.contentCenterYlocal displayW = display.contentWidthlocal displayH = display.contentHeightlocal mapMarginY = centerY + 35local dead = falselocal onAnim = truelocal level = 0local arrowTable = {}----loading the background maplocal map = display.newImage(backGroup, "Sprites/map.png", centerX, mapMarginY)local mapClosed = display.newImage(backGroup, "Sprites/mapd.png", centerX, mapMarginY)local mapOpened = display.newImage(backGroup, "Sprites/mapdo.png", centerX, mapMarginY)local doors = display.newImage(backGroup, "Sprites/doors.png", centerX, mapMarginY)map.alpha = 1mapClosed.alpha = 0mapOpened.alpha = 1doors.alpha = 0----loading sheet--playerlocal sheet = graphics.newImageSheet( "Sprites/sheet test.png", options )local playerMarginY = displayH - 80local playerM = display.newImage(playerGroup, sheet, 1 , centerX, playerMarginY)local playerL = display.newImage(playerGroup, sheet, 2 , centerX, playerMarginY)local playerR = display.newImage(playerGroup, sheet, 3 , centerX, playerMarginY)physics.addBody( playerM, { isSensor=true } )physics.addBody( playerL, { isSensor=true } )physics.addBody( playerR, { isSensor=true } )playerM.myName = "player"playerL.myName = "player"playerR.myName = "player"playerM.alpha = 0playerL.alpha = 0playerR.alpha = 0--shieldlocal sheetShield = graphics.newImageSheet( "Sprites/shield.png", optionsShield )local shieldMMarginY = playerM.y - playerM.contentHeight / 2local shieldM = display.newImage(itemGroup, sheetShield, 1 , centerX, shieldMMarginY)local shieldL = display.newImage(itemGroup, sheetShield, 2 , centerX - 22, playerM.y)local shieldR = display.newImage(itemGroup, sheetShield, 2 , centerX + 25, playerM.y)physics.addBody( shieldM, {isSensor = true} )physics.addBody( shieldL, {isSensor = true} )physics.addBody( shieldR, {isSensor = true} )shieldM.alpha = 0shieldL.alpha = 0shieldR.alpha = 0shieldM.myName = "shield"shieldL.myName = "shield"shieldR.myName = "shield"----CONTROLS---------------------local rRect = display.newRect(uiGroup, centerX + 80, centerY, 50, 50)local lRect = display.newRect(uiGroup, centerX - 80, centerY, 50, 50)local mRect = display.newRect(uiGroup, centerX, centerY, 50, 50)local paddingRect = mRect.contentWidthrRect.x = displayW - rRect.contentWidth/2 - paddingRectrRect.y = displayH - rRect.contentHeightrRect.alpha = 0.1lRect.x = displayW - lRect.contentWidth * 2.5 - paddingRectlRect.y = displayH - lRect.contentHeightlRect.alpha = 0.1mRect.x = displayW - mRect.contentWidth * 1.5 - paddingRectmRect.y = displayH - mRect.contentHeight * 2mRect.alpha = 0.1rRect.id = 1lRect.id = 2mRect.id = 0local triangleShape = { 0,-15, 20,15, -20,15 }local triangle = display.newPolygon(uiGroup, mRect.x, mRect.y, triangleShape )local triangler = display.newPolygon(uiGroup, rRect.x, rRect.y, triangleShape )local trianglel = display.newPolygon(uiGroup, lRect.x, lRect.y, triangleShape )triangler.rotation = 90trianglel.rotation = -90local function alphaChanger (p1, p2, p3)	playerM.alpha = p1	playerL.alpha = p2	playerR.alpha = p3	shieldM.alpha = p1	shieldL.alpha = p2	shieldR.alpha = p3endlocal function tapListener (event)	if (onAnim == false and dead == false) then		if (event.target.id == 1) then					alphaChanger(0, 0, 1)				elseif (event.target.id == 2) then						alphaChanger(0, 1, 0)				else						alphaChanger(1, 0, 0)		end	end	return trueendrRect:addEventListener( "tap", tapListener )lRect:addEventListener( "tap", tapListener )mRect:addEventListener( "tap", tapListener )-------------------------------------UI-----------------------------rectangle in the toplocal topRect = display.newRect(uiGroup, centerX, 0, displayW, 0)local paint = { 0.62, 0.62, 0.62 }topRect.alpha = 0.65topRect.fill = paint--Score hud elementlocal hudScore = display.newText(uiGroup, "Level: " .. level, 0, 0, "Fonts/SourceCodePro-Regular.ttf")hudScore.x = hudScore.contentWidthhudScore.y = hudScore.contentHeighthudScore:setFillColor( 0, 0, 0 )--setting the rectangle the correct sizetopRect.height = hudScore.contentHeight * 2topRect.y = topRect.contentHeight/2-------------------------------local StartLooplocal function CreateArrows()	local newArrow = display.newImage( itemGroup, "Sprites/arrow.png")	newArrow:scale( 0.75, 0.75 )	table.insert( arrowTable, newArrow )	physics.addBody( newArrow, "kinematic" )	newArrow.myName = "arrow"	local whereFrom = math.random( 3 )	--m	if (whereFrom == 1) then		newArrow.x = centerX		newArrow.y = centerY - 125		newArrow.rotation = 90		newArrow:setLinearVelocity( 0, math.random( 20,60 ) )		newArrow.isBullet = true	--l	elseif (whereFrom == 2) then		newArrow.x = centerX - 220		newArrow.y = playerMarginY		newArrow:setLinearVelocity( math.random( 40,120 ), 0 )		newArrow.isBullet = true	--r	else		newArrow.x = centerX + 220		newArrow.y = playerMarginY		newArrow.rotation = 180		newArrow:setLinearVelocity( math.random( 40,120 ) * -1, 0 )		newArrow.isBullet = true	endendlocal function Start()	mapOpened.alpha = 0	transition.to( mapOpened , {time = 400, alpha = 0} )	transition.to( shieldM , {time = 200, alpha = 1} )	transition.to( mapClosed, { time = 400, alpha = 1} )	transition.to( doors, {time = 400, alpha = 1, onComplete = StartLoop} )	onAnim = falseendlocal function Awake()	onAnim = true	playerM.y = displayH + playerM.contentHeight	playerM.alpha = 1	local backgroundMusic = audio.loadStream("Sounds/Main.ogg")	audio.setVolume(0 , { channel=1 }) 	local backgroundMusicChannel = audio.play( backgroundMusic, { channel=1, loops=-1}  )	transition.to( playerM, { time = 2000, y = playerMarginY, onComplete = Start} )	audio.fade( { channel=1, time=2000, volume=1 } )endlocal function gameLoop()	if(onAnim == false and dead == false) then	CreateArrows()	endendlocal function onCollision( event )     if ( event.phase == "began" ) then         local obj1 = event.object1        local obj2 = event.object2        if (obj1.myName == "arrow" and obj2.myName == "shield" and obj2.alpha == 1) then        	        	display.remove( obj1 )        	level = level + 1        	hudScore.text = "Level: " .. level        	for i = #arrowTable, 1, -1 do                if ( arrowTable[i] == obj1) then                    table.remove( arrowTable, i )                    break                end            end        elseif (obj1.myName == "shield" and obj2.myName == "arrow" and obj1.alpha == 1) then        	        	display.remove( obj2 )        	level = level + 1        	hudScore.text = "Level: " .. level        	for i = #arrowTable, 1, -1 do                if ( arrowTable[i] == obj1) then                    table.remove( arrowTable, i )                    break                end            end        elseif (obj1.myName == "arrow" and obj2.myName == "player") then        	display.remove(obj2)        	dead = true        	--make gameover        elseif (obj1.myName == "player" and obj2.myName == "arrow") then        	        	display.remove(obj1)        	dead = true            --make gameover        end    endendgameLoopTimer = timer.performWithDelay( 2000, gameLoop, 0 )Runtime:addEventListener( "collision", onCollision )Awake()